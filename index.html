<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Grupos de Materias</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <h1>Grupos de Materias por Carrera</h1>
      <p>
        Selecciona una carrera para ver las materias, profesores y grupos de
        WhatsApp.
      </p>
      <select id="careerSelect">
        <option value="">-- Selecciona una carrera --</option>
        <option value="sistemas.json">Sistemas</option>
        <option value="gestion.json">Gestión Empresarial</option>
        <option value="industrial.json">Industrial</option>
      </select>
      <input
        type="text"
        id="searchBar"
        placeholder="Buscar materia o profesor..."
        style="display: none"
      />
    </header>

    <section id="gruposGenerales" class="grupos-section">
      <h2>Grupos Generales por Carrera</h2>
      <ul id="listaGenerales"></ul>
    </section>

    <main id="content" style="display: none"></main>

    <section id="contribuir">
      <h2>Cómo contribuir</h2>
      <p>
        ¿Conoces algún grupo o profesor que falte en la lista? Comparte la
        información rellenando este formulario.
      </p>
      <a
        href="https://docs.google.com/forms/d/e/1FAIpQLSc7dqG45xnLOeuN6gZG1HVGj_82AS22eBy1gA6SoVtwM05YyA/viewform?usp=header"
        target="_blank"
        class="btn"
      >
        Enviar información
      </a>
    </section>

    <footer>
      <p><strong>Proyecto estudiantil sin afiliación oficial.</strong></p>
      <p>
        Este sitio web no pertenece ni está respaldado por el Tecnológico
        Nacional de México (TecNM) ni por ninguna de sus instituciones. No
        representa oficialmente a los profesores, grupos ni programas
        académicos.
      </p>
      <p>
        La información publicada tiene fines de apoyo entre estudiantes y puede
        no estar actualizada o ser precisa. El uso de este sitio es bajo tu
        propio riesgo.
      </p>
      <p>
        Los enlaces a los grupos de WhatsApp son proporcionados por la comunidad
        estudiantil y no son administrados por este sitio. Úsalos bajo tu propio
        criterio.
      </p>
    </footer>

    <script>
      const select = document.getElementById("careerSelect");
      const content = document.getElementById("content");
      const searchBar = document.getElementById("searchBar");
      const gruposGeneralesSection = document.getElementById("gruposGenerales");
      const listaGenerales = document.getElementById("listaGenerales");

      const generalGroups = [
        {
          name: "Sistemas",
          url: "https://chat.whatsapp.com/F0Zb3vBqZLtJ6tEddFG1Gj",
        },
        {
          name: "Gestión Empresarial",
          url: "https://chat.whatsapp.com/FENdZWAIx1v5OVPZVtIFYa",
        },
        {
          name: "Industrial",
          url: "",
        },
      ];

      let currentData = {};

      function renderGenerales() {
        listaGenerales.innerHTML = "";
        generalGroups.forEach((g) => {
          const li = document.createElement("li");
          const span = document.createElement("span");
          span.textContent = g.name;
          li.appendChild(span);

          let btn;
          if (g.url) {
            btn = document.createElement("a");
            btn.href = g.url;
            btn.target = "_blank";
            btn.className = "btn";
            btn.textContent = "WhatsApp";
          } else {
            btn = document.createElement("span");
            btn.className = "btn disabled";
            btn.textContent = "No disponible";
          }

          li.appendChild(btn);
          listaGenerales.appendChild(li);
        });
      }
      renderGenerales();

      select.addEventListener("change", () => {
        const file = select.value;

        if (!file) {
          content.style.display = "none";
          gruposGeneralesSection.style.display = "block";
          searchBar.style.display = "none";
          currentData = {};
          return;
        }

        gruposGeneralesSection.style.display = "none";
        content.style.display = "block";
        searchBar.style.display = "block";
        searchBar.value = "";

        fetch(file + "?v=" + Date.now())
          .then((res) => res.json())
          .then((data) => {
            currentData = data;
            renderCareer(currentData);
          });
      });

      searchBar.addEventListener("keyup", () => {
        const query = searchBar.value.toLowerCase();
        renderCareer(currentData, query);
      });

      function renderCareer(data, filter = "") {
        content.innerHTML = "";

        Object.keys(data).forEach((materia) => {
          const filteredProfs = data[materia].filter(
            (prof) =>
              prof.name.toLowerCase().includes(filter) ||
              materia.toLowerCase().includes(filter)
          );

          if (filteredProfs.length === 0) return;

          const details = document.createElement("details");
          const summary = document.createElement("summary");
          summary.textContent = materia;
          details.appendChild(summary);

          const ul = document.createElement("ul");
          filteredProfs.forEach((prof) => {
            const li = document.createElement("li");
            const span = document.createElement("span");
            span.textContent = prof.name;
            li.appendChild(span);

            let btn;
            if (prof.url) {
              btn = document.createElement("a");
              btn.href = prof.url;
              btn.target = "_blank";
              btn.className = "btn";
              btn.textContent = "WhatsApp";
            } else {
              btn = document.createElement("span");
              btn.className = "btn disabled";
              btn.textContent = "No disponible";
            }

            li.appendChild(btn);
            ul.appendChild(li);
          });

          details.appendChild(ul);
          content.appendChild(details);
        });
      }
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Grupos de Materias</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <h1>Grupos de Materias por Carrera</h1>
      <p>
        Selecciona una carrera para ver las materias, profesores y grupos de
        WhatsApp
      </p>
      <select id="careerSelect">
        <option value="">-- Selecciona una carrera --</option>
        <option value="sistemas.json">Sistemas</option>
        <option value="gestion.json">Gestión Empresarial</option>
        <option value="administracion.json">Administración</option>
      </select>
      <input
        type="text"
        id="searchBar"
        placeholder="Buscar materia o profesor..."
        style="display: none"
      />
    </header>

    <main id="content"></main>

    <footer>
      <p><strong>Proyecto estudiantil sin afiliación oficial.</strong></p>
      <p>
        Este sitio web no pertenece ni está respaldado por el Tecnológico
        Nacional de México (TecNM) ni por ninguna de sus instituciones. No
        representa oficialmente a profesores, grupos o programas académicos.
      </p>
      <p>
        La información publicada es con fines de apoyo entre estudiantes y puede
        no estar actualizada o ser precisa. El uso de este sitio es bajo tu
        propio riesgo.
      </p>
      <p>
        Los enlaces a grupos de WhatsApp son proporcionados por la comunidad
        estudiantil y no son administrados por este sitio. Úsalos bajo tu propio
        criterio.
      </p>
    </footer>

    <script>
      const select = document.getElementById("careerSelect");
      const content = document.getElementById("content");
      const searchBar = document.getElementById("searchBar");

      let currentData = {};

      select.addEventListener("change", () => {
        const file = select.value;

        if (!file) {
          content.innerHTML = "";
          searchBar.style.display = "none";
          currentData = {};
          return;
        }

        searchBar.style.display = "block";
        searchBar.value = "";

        fetch(file + "?v=" + Date.now())
          .then((res) => res.json())
          .then((data) => {
            currentData = data;
            renderCareer(data);
          });
      });

      searchBar.addEventListener("keyup", () => {
        const query = searchBar.value.toLowerCase();
        renderCareer(currentData, query);
      });

      function renderCareer(data, filter = "") {
        content.innerHTML = "";

        Object.keys(data).forEach((materia) => {
          const filteredProfs = data[materia].filter(
            (prof) =>
              prof.name.toLowerCase().includes(filter) ||
              materia.toLowerCase().includes(filter)
          );

          if (filteredProfs.length === 0) return;

          const details = document.createElement("details");
          const summary = document.createElement("summary");
          summary.textContent = materia;
          details.appendChild(summary);

          const ul = document.createElement("ul");
          filteredProfs.forEach((prof) => {
            const li = document.createElement("li");
            const span = document.createElement("span");
            span.textContent = prof.name;
            li.appendChild(span);

            let btn;
            if (prof.url) {
              btn = document.createElement("a");
              btn.href = prof.url;
              btn.target = "_blank";
              btn.className = "btn";
              btn.textContent = "WhatsApp";
            } else {
              btn = document.createElement("span");
              btn.className = "btn disabled";
              btn.textContent = "No disponible";
            }

            li.appendChild(btn);
            ul.appendChild(li);
          });

          details.appendChild(ul);
          content.appendChild(details);
        });
      }
    </script>
  </body>
</html>
